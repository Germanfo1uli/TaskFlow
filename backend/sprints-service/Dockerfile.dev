FROM mcr.microsoft.com/dotnet/sdk:8.0-alpine

WORKDIR /src

ENV NUGET_PACKAGES=/root/.nuget/packages

COPY . .

RUN apk add --no-cache curl

WORKDIR /src/sprints-service/Backend.Sprints.Api

CMD ["sh", "-c", "\
    rm -rf /src/shared-libs/Backend.Shared/obj /src/shared-libs/Backend.Shared/bin && \
    rm -rf obj bin && \
    dotnet restore --force && \
    dotnet run --urls http://*:8084"]